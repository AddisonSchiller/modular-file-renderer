
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-0-connect-to-ipython-cluster">Step 0. Connect to IPython Cluster</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[41]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">parallel</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">packer</span><span class="o">=</span><span class="s">&#39;pickle&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">load_balanced_view</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;We have </span><span class="si">%i</span><span class="s"> engines available&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
<span class="c"># skip cached results (for faster debugging)</span>
<span class="n">rc</span><span class="p">[:][</span><span class="s">&#39;skip_cache&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
We have 16 engines available

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A utility for monitoring progress while waiting on an AsyncResult:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[42]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="k">def</span> <span class="nf">wait_on</span><span class="p">(</span><span class="n">ar</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span><span class="p">)</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">_client</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;submitted&#39;</span><span class="p">]</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">ar</span><span class="o">.</span><span class="n">ready</span><span class="p">():</span>
        <span class="n">ar</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span> <span class="n">msg_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rc</span><span class="o">.</span><span class="n">outstanding</span> <span class="k">for</span> <span class="n">msg_id</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span> <span class="p">])</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">submitted</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%3i</span><span class="s">/</span><span class="si">%3i</span><span class="s"> tasks finished after </span><span class="si">%4i</span><span class="s"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">),</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">print</span>
    <span class="k">print</span> <span class="s">&quot;done&quot;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-1-slice-alignments">Step 1. Slice alignments</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[43]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">base_region_boundaries</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">(</span><span class="s">&#39;v2&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">1868</span><span class="p">),</span> <span class="c">#27f-338r</span>
      <span class="p">(</span><span class="s">&#39;v2.v3&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">2232</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v2.v4&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">4051</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v2.v6&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">4932</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v2.v8&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">6426</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v2.v9&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">6791</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v3&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">2232</span><span class="p">),</span> <span class="c">#349f-534r</span>
      <span class="p">(</span><span class="s">&#39;v3.v4&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">4051</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v3.v6&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">4932</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v3.v8&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">6426</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v3.v9&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">6791</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v4&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">4051</span><span class="p">),</span> <span class="c">#515f-806r</span>
      <span class="p">(</span><span class="s">&#39;v4.v6&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">4932</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v4.v8&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">6426</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v4.v9&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">6791</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v6&#39;</span><span class="p">,</span> <span class="mi">4653</span><span class="p">,</span> <span class="mi">4932</span><span class="p">),</span> <span class="c">#967f-1048r</span>
      <span class="p">(</span><span class="s">&#39;v6.v8&#39;</span><span class="p">,</span> <span class="mi">4653</span><span class="p">,</span> <span class="mi">6426</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v6.v9&#39;</span><span class="p">,</span> <span class="mi">4653</span><span class="p">,</span> <span class="mi">6791</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v9&#39;</span><span class="p">,</span> <span class="mi">6450</span><span class="p">,</span> <span class="mi">6791</span><span class="p">),</span> <span class="c">#1391f-1492r</span>
      <span class="p">(</span><span class="s">&#39;full.length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7682</span><span class="p">),</span>  <span class="c"># Start 150, 250, 400 base pair reads</span>
      <span class="p">(</span><span class="s">&#39;v2.150&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">702</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v2.250&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">1752</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v2.v3.400&#39;</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">2036</span><span class="p">),</span> <span class="c"># Skips reads that are larger than amplicon size</span>
      <span class="p">(</span><span class="s">&#39;v3.v4.150&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">2235</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v3.v4.250&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">2493</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v3.v4.400&#39;</span><span class="p">,</span> <span class="mi">1916</span><span class="p">,</span> <span class="mi">4014</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v4.150&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">3794</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v4.250&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">4046</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v4.v6.400&#39;</span><span class="p">,</span> <span class="mi">2263</span><span class="p">,</span> <span class="mi">4574</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v6.v8.150&#39;</span><span class="p">,</span> <span class="mi">4653</span><span class="p">,</span> <span class="mi">5085</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v6.v8.250&#39;</span><span class="p">,</span> <span class="mi">4653</span><span class="p">,</span> <span class="mi">5903</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&#39;v6.v8.400&#39;</span><span class="p">,</span> <span class="mi">4653</span><span class="p">,</span> <span class="mi">6419</span><span class="p">)</span>
<span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s"> regions, which we will break up into tasks to be done in parallel&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_region_boundaries</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
32 regions, which we will break up into tasks to be done in parallel

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[44]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">base_percentages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">82</span><span class="p">]</span>

<span class="n">seq_file_base</span> <span class="o">=</span> <span class="s">&#39;/home/ubuntu/qiime_software/gg_otus-4feb2011-release/rep_set/gg_</span><span class="si">%i</span><span class="s">_otus_4feb2011_aligned.fasta&#39;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we want to use multiple seq_files, that&#39;s a nested list:</p>
<pre><code>sub_alignments = []
for seq_file in seq_files:
    for region_boundary in region_boundaries:
        sub_alignemnts.append(load_sub_alignment(seq_file, region_boundary)
</code></pre><p>This can actually be transformed into a flat list suitable for map with clever use of <code>itertools.product</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[45]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">itertools</span>
<span class="n">list_of_tuples</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">base_percentages</span><span class="p">,</span> <span class="n">base_region_boundaries</span><span class="p">)</span>
<span class="n">percentages</span><span class="p">,</span> <span class="n">region_boundaries</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_tuples</span><span class="p">)</span>
<span class="n">seq_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">seq_file_base</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">percentages</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">rb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">rb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">percentages</span><span class="p">,</span> <span class="n">region_boundaries</span><span class="p">)</span> <span class="p">]</span>

<span class="n">ntasks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_boundaries</span><span class="p">)</span>
<span class="n">ntasks</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[45]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
32
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Loading data is an expensive operation.  This takes the most time, of any steps</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[46]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">load_sub_alignment</span><span class="p">(</span><span class="n">seq_file</span><span class="p">,</span> <span class="n">region_boundary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;load subregion of data into new file&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">cogent</span> <span class="kn">import</span> <span class="n">LoadSeqs</span>
    <span class="kn">from</span> <span class="nn">cogent.core.alignment</span> <span class="kn">import</span> <span class="n">DenseAlignment</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="n">id_</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">region_boundary</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">seq_file</span><span class="p">))</span>
    <span class="n">sub_fname</span> <span class="o">=</span> <span class="s">&#39;/home/ubuntu/data/&#39;</span> <span class="o">+</span> <span class="n">base</span> <span class="o">+</span> <span class="s">&quot;_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">id_</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="k">if</span> <span class="n">skip_cache</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sub_fname</span><span class="p">):</span>
        <span class="c"># skip if we&#39;ve already generated it</span>
        <span class="k">return</span> <span class="n">sub_fname</span>
    <span class="n">aln</span> <span class="o">=</span> <span class="n">LoadSeqs</span><span class="p">(</span><span class="n">seq_file</span><span class="p">,</span> <span class="n">aligned</span><span class="o">=</span><span class="n">DenseAlignment</span><span class="p">)</span>
    <span class="n">sub_alignment</span> <span class="o">=</span> <span class="n">aln</span><span class="o">.</span><span class="n">takePositions</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
    <span class="n">sub_alignment</span><span class="o">.</span><span class="n">writeToFile</span><span class="p">(</span><span class="n">sub_fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub_fname</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Submit the loads to be done in parallel</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[47]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">amr</span> <span class="o">=</span> <span class="n">load_amr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">map_async</span><span class="p">(</span><span class="n">load_sub_alignment</span><span class="p">,</span> <span class="n">seq_files</span><span class="p">,</span> <span class="n">region_boundaries</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Submission is asynchronous, and returns immediately.</p>
<p>Now we wait for the computations to actually finish, returning the list of filenames for the subregions.</p>
<p><strong>this will take time</strong></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[48]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">wait_on</span><span class="p">(</span><span class="n">amr</span><span class="p">)</span>
<span class="n">sub_aligns</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="n">sub_aligns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
  32/ 32 tasks finished after  236 s
done

</pre>
</div>
</div>

<div class="output_area"><div class="prompt output_prompt">
    Out[48]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
[&apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.v3.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.v4.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.v6.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.v8.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.v9.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v4.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v6.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v8.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v9.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.v6.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.v8.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.v9.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v6.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v6.v8.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v6.v9.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v9.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_full.length.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.150.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.250.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v2.v3.400.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v4.150.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v4.250.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v3.v4.400.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.150.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.250.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v4.v6.400.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v6.v8.150.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v6.v8.250.fasta&apos;,
 &apos;/home/ubuntu/data/gg_82_otus_4feb2011_aligned_v6.v8.400.fasta&apos;]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let&#39;s take a quick peek at the overhead of performing this compuation with IPython</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[49]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">print_parallel_stats</span><span class="p">(</span><span class="n">ar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;print some performance info for a given AsyncResult&quot;&quot;&quot;</span>
    <span class="n">ar</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="n">serial</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span><span class="n">stop</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">started</span><span class="p">,</span> <span class="n">ar</span><span class="o">.</span><span class="n">completed</span><span class="p">):</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
    <span class="n">longest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">serial</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">received</span><span class="p">)</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">submitted</span><span class="p">)</span>
    <span class="n">wall</span> <span class="o">=</span> <span class="p">(</span><span class="n">finished</span> <span class="o">-</span> <span class="n">submitted</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    
    <span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
    <span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ntasks</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;time (s)&quot;</span><span class="p">)</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&quot;min=</span><span class="si">%i</span><span class="s">s                  max=</span><span class="si">%i</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">times</span><span class="p">)))</span>
    
    <span class="k">print</span> <span class="s">&quot;ran </span><span class="si">%.1f</span><span class="s">s of work in </span><span class="si">%.1f</span><span class="s">s in </span><span class="si">%i</span><span class="s"> tasks on </span><span class="si">%i</span><span class="s"> engines&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="n">wall</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">ids</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;for a speedup of </span><span class="si">%.1f</span><span class="s">x&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">serial</span><span class="o">/</span><span class="n">wall</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;longest task was </span><span class="si">%.1f</span><span class="s">s, which is the best we could hope to do.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longest</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;IPython overhead: </span><span class="si">%i</span><span class="s">ppm&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">1e6</span><span class="o">*</span><span class="p">(</span><span class="n">wall</span><span class="o">-</span><span class="n">longest</span><span class="p">)</span><span class="o">/</span><span class="n">longest</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[50]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">print_parallel_stats</span><span class="p">(</span><span class="n">load_amr</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
ran 1397.5s of work in 236.3s in 32 tasks on 16 engines
for a speedup of 5.9x
longest task was 129.3s, which is the best we could hope to do.
IPython overhead: 826950ppm

</pre>
</div>
</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
AABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-2-filter-hypervariable-positions-and-mostly-gapped-positions">Step 2. Filter hypervariable positions and mostly gapped positions</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[51]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">filter_alignment</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;call out to subcommand, which filters the positions&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;filter_alignment.py -i </span><span class="si">%s</span><span class="s"> -e 0.1 -g 0.8 --suppress_lane_mask_filter -o /home/ubuntu/data/&quot;</span> <span class="o">%</span> <span class="n">fname</span>
    <span class="c"># RUN cmd</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s">&#39;_pfiltered&#39;</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="k">return</span> <span class="n">filtered</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This one is quick, so we do it synchronously, but still in parallel:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[52]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">%</span><span class="k">time</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">map_sync</span><span class="p">(</span><span class="n">filter_alignment</span><span class="p">,</span> <span class="n">sub_aligns</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
CPU times: user 0.51 s, sys: 0.07 s, total: 0.58 s
Wall time: 5.37 s

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-3-build-trees-in-parallel">Step 3. Build trees in parallel</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[53]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">build_tree</span><span class="p">(</span><span class="n">filtered_aln_fp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;build tree from a filtered alignment&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">cogent</span> <span class="kn">import</span> <span class="n">LoadSeqs</span>
    <span class="kn">from</span> <span class="nn">cogent.core.alignment</span> <span class="kn">import</span> <span class="n">DenseAlignment</span>
    <span class="kn">from</span> <span class="nn">cogent.app.fasttree</span> <span class="kn">import</span> <span class="n">build_tree_from_alignment</span>
    <span class="kn">from</span> <span class="nn">cogent</span> <span class="kn">import</span> <span class="n">DNA</span>
    
    <span class="n">tree_fp</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.tre&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filtered_aln_fp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">skip_cache</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tree_fp</span><span class="p">):</span>
        <span class="c"># skip already done</span>
        <span class="k">return</span> <span class="n">tree_fp</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">build_tree_from_alignment</span><span class="p">(</span><span class="n">LoadSeqs</span><span class="p">(</span><span class="n">filtered_aln_fp</span><span class="p">,</span> <span class="n">aligned</span><span class="o">=</span><span class="n">DenseAlignment</span><span class="p">),</span> <span class="n">moltype</span><span class="o">=</span><span class="n">DNA</span><span class="p">)</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">writeToFile</span><span class="p">(</span><span class="n">tree_fp</span><span class="p">,</span><span class="n">with_distances</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree_fp</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is the other step that takes some real time.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>this will take time</strong></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[54]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">amr</span> <span class="o">=</span> <span class="n">tree_amr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">map_async</span><span class="p">(</span><span class="n">build_tree</span><span class="p">,</span> <span class="n">filtered</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[55]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">wait_on</span><span class="p">(</span><span class="n">amr</span><span class="p">)</span>
<span class="n">trees</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
  32/ 32 tasks finished after  200 s
done

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[56]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">print_parallel_stats</span><span class="p">(</span><span class="n">tree_amr</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
ran 1299.5s of work in 200.1s in 32 tasks on 16 engines
for a speedup of 6.5x
longest task was 100.7s, which is the best we could hope to do.
IPython overhead: 986627ppm

</pre>
</div>
</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-4-compute-distances-between-trees">Step 4. Compute distances between trees</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>compare_trees()</code> computes the distance <em>submatrix</em> corresponding to a given tree.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[57]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">compare_trees</span><span class="p">(</span><span class="n">list_of_tree_files</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">nreps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">sample_percent</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;compute section of distance matrix for a single tree&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">cogent.parse.tree</span> <span class="kn">import</span> <span class="n">DndParser</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">mean</span>

    <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">DndParser</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">list_of_tree_files</span><span class="p">]</span>
    <span class="n">dist_mat</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">trees</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">trees</span><span class="p">)))</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">t1_ntips</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">tips</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">dj</span><span class="p">,</span><span class="n">t2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trees</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">dj</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">sample_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">t1_ntips</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">tips</span><span class="p">()))</span> <span class="o">*</span> <span class="n">sample_percent</span><span class="p">)))</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="o">.</span><span class="n">compareByTipDistances</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nreps</span><span class="p">)]</span>
        <span class="n">dist_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">dist_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dist_mat</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For instance, the distance elements for the third-to-last tree:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[58]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">%</span><span class="k">precision</span> <span class="mi">3</span>
<span class="n">compare_trees</span><span class="p">(</span><span class="n">trees</span><span class="p">,</span> <span class="n">ntasks</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[58]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
array([[ 0.   ,  0.   ,  0.   , ...,  0.   ,  0.   ,  0.   ],
       [ 0.   ,  0.   ,  0.   , ...,  0.   ,  0.   ,  0.   ],
       [ 0.   ,  0.   ,  0.   , ...,  0.   ,  0.   ,  0.   ],
       ..., 
       [ 0.   ,  0.   ,  0.   , ...,  0.   ,  0.087,  0.132],
       [ 0.   ,  0.   ,  0.   , ...,  0.087,  0.   ,  0.   ],
       [ 0.   ,  0.   ,  0.   , ...,  0.132,  0.   ,  0.   ]])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can then compute these submatrices in parallel</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[59]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">map_trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">trees</span><span class="p">]</span><span class="o">*</span><span class="n">ntasks</span>
<span class="n">amr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">map_async</span><span class="p">(</span><span class="n">compare_trees</span><span class="p">,</span> <span class="n">map_trees</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntasks</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And compute the final distance matrix by perorming a sum (via builtin <code>reduce()</code>)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>this will take the most time</strong></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[60]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">_print_progress</span><span class="p">(</span><span class="n">ar</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span><span class="p">)</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">_client</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;submitted&#39;</span><span class="p">]</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span> <span class="n">msg_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rc</span><span class="o">.</span><span class="n">outstanding</span> <span class="k">for</span> <span class="n">msg_id</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">msg_ids</span> <span class="p">])</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">submitted</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">clear_output</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%4i</span><span class="s">/</span><span class="si">%3i</span><span class="s"> tasks finished after </span><span class="si">%4i</span><span class="s"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">),</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">progress_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
    <span class="n">_print_progress</span><span class="p">(</span><span class="n">amr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span>

<span class="n">dist_mat</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">progress_sum</span><span class="p">,</span> <span class="n">amr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dist_mat</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="s">&#39;/home/ubuntu/data/dist_mat_fast.np&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
   32/ 32 tasks finished after  174 s

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can peek at the distance matrix, to see if there is anything interesting.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[61]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c"># Uncomment here to load dist_mat from cache, to regenerate plots</span>
<span class="c"># import numpy</span>
<span class="c"># dist_mat = numpy.fromfile(&#39;/home/ubuntu/data/dist_mat.np&#39;).reshape(ntasks,ntasks)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[62]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">pcolor</span><span class="p">(</span><span class="n">dist_mat</span><span class="p">)</span>
<span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntasks</span><span class="p">)</span>
<span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ntasks</span><span class="p">)</span>
<span class="n">colorbar</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[62]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
&lt;matplotlib.colorbar.Colorbar instance at 0x7fd8b47161b8&gt;
</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAV4AAAD5CAYAAABvRV34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAALEgAACxIB0t1+/AAAIABJREFUeJzt3X1YlNeZP/DvoyJqVBQhQgKCVCKDIkx0GNMaINYFqwXx
5VfFbbYrNh3NCxhRs9nNNphsG5P+siGlrpk0IU2rJunGNWrXSKDNiDHhJQY1waG+TjVGEjARsKAB
fPaPiaMDzLkPM8MwM7k/1zXXJdznOec4jMeHM/ecW1FVVQVjjDGPGTTQE2CMsW8bXngZY8zDeOFl
jDEP44WXMcY8jBdexhjzMF54GWPMw4b0V8eKovRX14wxP+RqZusIRUG7ZNuxY8fiyy+/dGk8Vyj9
lcerKAqmq++51Mehqu+JG3xOdPAHiUE+KgRiCh2Gs8teJ7t4a+8ycYMGooPHyCEAtRAIL3Qc30Rc
3yQxxk+IeCfdxdrHR2Bt4QiH8QiFej5vJ8dQM+KFcWWE+CWtPq6g8AWgcJXjNv+W+O/CPo5BPIc2
OH4OrvsaQ4Vx07G5wOZC4IFCh22GhrWIxygbLZ7EVXEYABBIxNcDaC4Eggp7j5/bKDFIocsLr6Io
+A/Jto/B9YXeFf12x8sYY54WMNATkMR7vIwxvzFE8tGbiooKaDQaxMbGori42OEYNTU1GDJkCHbs
2GH7XnR0NKZNmwatVovk5GSpeX67jU0b6BnIGZk20DOQcleab9xzpM0Y6BlI0qUN9AzkBKYN9AwA
AMNduDY/Px9GoxFRUVHIyMhATk4OQkJC7Np0dXXhkUcewdy5c+2+rygKTCYTgoODpcbiO15fWXhH
pQ30DKTwwutmyWkDPQM5w9IGegYArFsNMo/umpubAQApKSmIiopCeno6qqqqerQrLi7GkiVLEBoa
2iPWlz1jXngZY37D2a2GmpoaxMXF2b6Oj49HZWWlXZvz589j165dWL16NQD7zC1FUTB79mxkZ2dj
9+7dUvPsN/E45jD2ZssSuoNmIn6ZiMu8YztKHH7rs4V0H1TWwkkiTr+RD/T8D9beJOJ/2waJ9L5Y
It5Bd3Ecd4gbaOaI4yfoMcifO7XFdpEeQvTaBYCX8FNhvOnzceQYY0MviRt8SnaBr6+IsxaG/+Ar
Ybz99bH0IL8j4lTWQuTj9BjnCuk2Ehz9vmX+5uGKNWvWYNOmTVAUBaqq2t3hHjx4EOHh4TCbzcjM
zERycjLCwsIc9sV3vIwxv+HoDjcBwI9uenSn0+lQX19v+7qurg4zZ860a3Po0CEsW7YMEydOxI4d
O3D//ffb7m7Dw8MBABqNBllZWdizZ49wnrzwMsb8hrN7vEFBQQCsmQ0WiwVlZWXQ6/V2bU6fPo0z
Z87gzJkzWLJkCbZs2YKsrCy0tbWhtbUVANDY2IjS0tIeb751J9xquHLlClJTU3H16lUMGzYMS5cu
xcMPP4zW1lb8+Mc/Rm1tLe68805s3boVI0eOpJ8VxhjrR668tVtUVASDwYCOjg7k5eUhJCQERqMR
AGAwGBxe19DQgEWLFgEAxo0bh4KCAkRGRgrHEi68w4YNw7vvvosRI0bg6tWrmD59On74wx9i586d
mDBhAv74xz+ioKAAL7zwAtatW9fXvydjjLmVK+lkqampMJvtd4IdLbivvPKK7c8xMTE4fPhwn8Yi
txpGjLB+9PHy5cvo7OxEYGAgqqursXLlSgQGBiI3N7fXtAvGGPM0Vz5A4Unkwnvt2jUkJiZi/Pjx
ePDBBzFhwgS71Iu4uDhUV1f3+0QZY4zi7B6vp5GL/6BBg3DkyBFYLBbMmzcP3/ve96QThRsLjbY/
T0oLx6S022xf/3X0ZPL66ugUcYMQcRj/TA4BEBk96beVkl28k5YpbpBGdBAnkep1QRyeHvO+MH4I
36XH+BdiHlQaF4CzEO9tkaeYfEKPASMRJ84swrv0EONmi3POomERxoeO/5ocYwzEqV7D0+mztm7D
Z8L4YHQJ4+d+Rvy8AHxq2CZucA+RLtbbb+vHTNaHbSLkNKR4w92sDOl5RkdHY968eaiqqoJOp4PZ
bIZWq4XZbIZOp+v1mrmF0902UcaYH4lPsz6ue1PmBDOaN9zNyhBuNTQ1NeHSJest4cWLF/HOO+9g
wYIF0Ov1KCkpQXt7O0pKSnrkuzHG2EDwiz3eCxcuYPbs2UhMTMTy5cuxbt06hIeHY/Xq1Th79iwm
T56M8+fPY9UqwcGmjDHmIX6xx5uQkICPPvqox/dHjRqFXbt29dukGGPMGa6kk3mSN9x1M8aYW3jD
3awMXngZY37DVxa0fq25hs0udk0dakSdMiU1PJGy87LELy8rqWO7qP+HJY79Isv4UXGZMcYTcbro
WqN6qzAeur1V3EGlOAwAqkmc9qZ8LP7Bf6BqyTGW4TVh/G9PxwnjVFYdALoO3pMSfVDj1FJHnL1M
DhGh/qMw/umLk8QdDCOHAH6iuKXm2kXJlXdcJ9dcY4wxtxgiu6JJFG7tT7zwMsb8RsDggZ6BHF54
GWN+Q/qOd4D5yDQZY4wWEDjQM5DDCy9jzH/4yIrGFSgYY/7Dhc8MV1RUQKPRIDY2FsXFxQ6HqKmp
wZAhQ7Bjx44+X3vzNPtPmiA2TCKV43XitCyq6EU9EQeATiJdbJZEH0OIdLEk4vqLEmnfI4k2HxNH
c1JFJgHgChFvpecZ8glxhBn1XEicgIZ9RDxBHNa20YdW60eIz5j+211EOlm0xNvmHxD//GRS0sjX
OJUutpIcIpKoQHpxmbiwZ/vbEgU13cWFFS0/Px9GoxFRUVHIyMhATk4OQkLsj0Ds6urCI4880qO0
j8y1N+M7XsaY/xgs+eimudla0jwlJQVRUVFIT0/vtcBDcXExlixZgtDQ0D5fezNeeBlj/sPJrYab
izsAQHx8PCor7T/Nc/78eezatQurV68G8M2HxCSv7W2ajDHmHxxkNZguWx+uWLNmDTZt2gRFsX7K
zpVPvvHCyxjzHw5WtLQx1sd1Gxvs4zqdDuvXr7d9XVdX12Mf99ChQ1i2zFrepKmpCW+//TYCAgKQ
mppKXtsdbzUwxvyHk1sNQUFBAKzZCRaLBWVlZdDr9XZtTp8+jTNnzuDMmTNYsmQJtmzZgqysLKlr
e5smY4z5Bxc+MlxUVASDwYCOjg7k5eUhJCQERqO1wJ+jMu+ia0X6d+Edc9Vx7JzER0wiXByfyPgB
ADTQTUihdBOhMIk21P6UQqSLUaliAEBVcLLQXfzP1B8I48NbxAUe2yMkUo9uIeJUEVQJQ4gikeTz
eUXin5aFiMu8LmqJWmXDiSP+JP6NdOG0MN5+UvwzG/oPLeQYdGlQSS6saKmpqTCbzXbfc7TgvvLK
K+S1InzHyxjzHz6yovnINBljTIKPrGg+Mk3GGJPAh+QwxpiH+ciK5iPTZIwxCXwQOmOMeZiPrGj9
O80/CDZcjBLXn6EK9VEFHsWnJlm1icMzJHLaWk3i+IU0cVzmp9BJFKuMJE4OoworAkANEScyrABg
Bg4J40OHCVIMAbR/TI8BcRdAufh1cXTEVHKIDzFD3KCQ6OATcgj65dtJpIoBwA+IdDEqXfIcPcRn
uE3cgHhtfT1sND2Iu/DCyxhjHsZbDYwx5mE+sqIJz2o4d+4c7rnnHkyZMgVpaWnYvn07AKCwsBAR
ERHQarXQarXYt486mZoxxjxgmORjgAn/fwgICMBzzz2HpKQkNDU1ITk5GZmZmVAUBWvXrsXatWs9
NU/GGKP5w1ZDWFgYwsKsHxgPCQnBlClTUFNjfQfGlbMoGWOsX/jIVoP0NE+ePIm6ujro9XocOHAA
xcXF+O///m8sXLgQ999/P0aNGtXzovLCG3+OSbM+GGOs2gTUmNzfr48svIoqceva2tqKtLQ0/Pzn
P8eCBQvwxRdfIDQ0FC0tLVi/fj3uuOMOrFu3zr5jRQGOCLpeJjE7CxGnTqmSqCGJMUTc/LlEJ+PF
YarOpMzpZlR60k+JuEw6GXUCGlVcFED1E+JKk0asEsZfPvoAOYa6SVwEVWkQv6RP/4VIjwLwGP5D
GN8emyvu4Dw5BNBOpIsNIVLFABDTBKKJuMTLe2qeOM/wwjXx85kwiM4RNCk/cPm3aEVRoP6rZNtf
Duxv7eRB6B0dHVi8eDHuvfdeLFiwAABw6623QlEUBAUF4YEHHsDOnTv7faKMMUZyoby7JwkXXlVV
sXLlSkydOhVr1qyxff/ChQsAgM7OTmzfvh3z5s3r31kyxpgMFxbeiooKaDQaxMbGori4uEd8165d
SExMRFJSEubPn297vwsAoqOjMW3aNGi1WiQnJ0tN06GDBw9i69attg4B4Je//CVee+01HD58GEOH
DkVKSoqt6iZjjA0oF04ny8/Ph9FoRFRUFDIyMpCTk2NXSWLOnDm23/r379+PgoICVFRUALBuc5hM
JgQHB0uNJVx4Z82ahWvXrvX4/g9+IK4ywBhjA8LJbYTm5mYAQEpKCgAgPT0dVVVVmD9/vq3NLbfc
Ytd+2DD7hOC+7BlzsUvGmP9wcquhpqYGcXE36iDFx8ejsrKyR7udO3ciOjoaubm5ePHFF23fVxQF
s2fPRnZ2Nnbv3i01TcYY8w8OPkBhOmF9uGrhwoVYuHAh3njjDSxcuBC1tbUArNuy4eHhMJvNyMzM
RHJysu0zEL3p34VX1LtMIT/iQC6STJoWVRjRLJEXNJxIJ6PmIVOckUp7+yHxa84+cQqWFIlXywji
yK1ziBTGI6adpAfZT8S/Lw5PPHKBHGJc4kVxgzSig5ckThajClHK/OtcSMSHdYrj79GDXIK4mOVX
jeIX59DxbitlSXPw10nTWB/XbdxrH9fpdFi/fr3t67q6OsydO9fhMEuXLkVeXh7a29sxfPhwhIeH
AwA0Gg2ysrKwZ88e3HfffQ6v560Gxpj/cHKrISgoCIA1s8FisaCsrAx6vd6uzalTp2z7uHv37sX0
6dMxfPhwtLW1obW1FQDQ2NiI0tJS4aJ9fZqMMeYfXDiroaioCAaDAR0dHcjLy0NISAiMRuvB4QaD
ATt27MDvf/97BAQEQKvV4plnngEANDQ0YNGiRQCAcePGoaCgAJGR4t/seOFljPkPF04eS01Nhdls
tvuewWCw/XnDhg3YsGFDj+tiYmJw+PDhPo3FCy9jzH/4yIrmI9NkjDEJ/nAsJGOM+RQfWdH6d5qi
g6gOtEh04GKRvEtuaJN5p+t9UAUHqVPWADqdrJJIF6uVGEP8fgAgUffzIlFgtA3DhfHWryWOQKMO
F/tQHK5N1IgbACjeu17cgEoX+6nEyWImIi6TDmkh4sOIf+ISxS5vw2fC+NfjhwrjI6iCsu7ECy9j
jHkYbzUwxpiHeUE9NRm88DLG/Aff8TLGmIf5yIrmI9NkjDEJPrKi+cg0GWNMgo+saP07zcmC2CqJ
VLEZRPwrIi4+VMmKSPV6KOVXZBflRDVLS0u0MD5qdCs5RmtLL1WcbxI92iKMn5r7HXKM7wSfEsZl
0oJSqqqF8Wl6ceHDlKEHyDFwhoj/Whw+iUn0GPOJdLH/FaeLPTSPft1QqXcfkv8AgBlE7lwnselZ
laIXxgFgI8R/V+rvcQzx5BhvkS0k8R4vY4x5mI+saD4yTcYYk+BCzTVP4oWXMeY/fGRF85FpMsaY
BB9Z0bgCBWPMfzhZgQKwVp/QaDSIjY1FcXFxj/iuXbuQmJiIpKQkzJ8/HzU1NdLXdscLL2PMb6iD
5R69yc/Ph9FoRHl5OTZv3oympia7+Jw5c3DkyBEcPnwYGzZsQEFBgfS13fXrjflvfvtTh7Hvo5y8
/mNMI+IJwvhybCPHuHSHOOcsvusY2cf9gzeLGxCZc1+AKJYJ4Opo8QlQk3FcGLcER5NjjIO4wGMr
xCltAEBkHmHzbwqE8ZaJ4r8nAGwk6lC+t1ychjVLySTH+KN6SBifRKRIaY+YhXEAOJMYLow3EWla
ADCt7ROyjUjtiCSyzczNRHUF6rC3cTvIMX5JtpDT5eSK1tzcDABISUkBAKSnp6Oqqgrz58+3tbnl
llvs2g8bNkz62u74jpcx5je6hsg9uqupqUFcXJzt6/j4eFRWVvZot3PnTkRHRyM3Nxe//e1v+3Tt
zYT/P5w7dw7/9E//hC+++AKhoaH42c9+huXLl6O1tRU//vGPUVtbizvvvBNbt27FyJES56gyxlg/
uhrY+29MB/Zfw3v71Zu+0+VU/wsXLsTChQvxxhtvIDs7G7W1Mgdd9yS84w0ICMBzzz2Huro6vPnm
m3jsscfQ2tqKLVu2YMKECThx4gQiIiLwwgsvODU4Y4y5U9fgwb0+vjs7ABs2DrU9utPpdKivr7d9
XVdXh5kzZzocZ+nSpfjss8/Q3t6OGTNm9OlagFh4w8LCkJRk3QMKCQnBlClTUFNTg+rqaqxcuRKB
gYHIzc1FVVWVcBDGGPOELgyWenQXFBQEwJqdYLFYUFZWBr3e/uPUp06dgqpa75r37t2L6dOnY/jw
4RgzZgx5bXfSW9EnT55EXV0dkpOTsWLFCtueRlxcHKqrxZ/PZ4wxT6DOphApKiqCwWBAR0cH8vLy
EBISAqPRCMBa5n3Hjh34/e9/j4CAAGi1WjzzzDPCa0WkFt7W1lYsXboUzz33HEaOHGlb9Sl7Cz+y
/Tk2LRyxaeJ3cRlj3w6mD60Pd+tyIVErNTUVZrN9NorBYLD9ecOGDdiwYYP0tSLkLDs6OrB48WLc
e++9WLBgAQDrfojZbIZWq4XZbIZOp+v12r0VNxZeVAB44qag+E0/q/YTRIOPhNEnJU5FAtrF4UzH
KXE2e6gG1A+EmAMAsqrhxEXi+JlPJcYYQcSJPC4Af1TF6WI/Wr5b3EG9OAwAaoy4sKdCpIu9p5I/
MMzaTqwK/0F0QB8sBlA/knclXhdzxMVD8TlxvfiwOKs6Iv46EZfKeCOKtUrqbRvBGwn3eFVVxcqV
KzF16lSsWbPG9n29Xo+SkhK0t7ejpKSE3EhmjDFPcHaP19OEC+/BgwexdetW/OUvf4FWq4VWq8W+
ffuwevVqnD17FpMnT8b58+exapWojjtjjHnGVQyVegw04VbDrFmzcO3atV5ju3bt6pcJMcaYs1zZ
4/Uk35glY4xJ8IZtBBm88DLG/AYvvIwx5mGu5PF6Ur8uvGfedZwiEk2daAQAtxHxs0RcJqXnCyJ+
4T66D+rvcgsRlylXEkvEK4j49yXGcINyIitITSAaTKTHUGoLxWPEiOMbJTKX1HEuzvPP9BhIJeIy
/0bEpw8CV4i4+IA/q38g4tRzIXGMi3uSyXiPlzHGPI63GhhjzMO+9oJUMRm88DLG/Abv8TLGmIfx
Hi9jjHkY7/EyxpiH8cILYI7q+Fiiz9voAo+Xi8VnWpInL71JDkGmco08QuXrAJdfJ+Z5kujgKXII
4CAR/18i/p7EGE+1EA2oOGBWZwnjimISd/Dxq+QYalaheIxz4mNLmzvp/L1/G/yIML756/uF8VFD
L5NjfHp0krjB22QXdDoYdQKazMlhxMsbTxLxTpnjEmVOEqT5yh4vF7tkjPmNrxEo9ehNRUUFNBoN
YmNjUVxc3CO+bds2JCYmIjExEcuXL8fx4zcqe0dHR2PatGnQarVITk4m58lbDYwxv+HKVkN+fj6M
RiOioqKQkZGBnJwcu0oSMTExqKioQFBQEF599VU8+eST+MMf/gAAUBQFJpMJwcHBUmPxHS9jzG90
YrDUo7vm5mYAQEpKCqKiopCent6jluRdd91lq802f/587N+/3y4uW5kH4IWXMeZHujBE6tFdTU2N
rY4kAMTHx6Oy0nGZnBdffBGZmTcqnSiKgtmzZyM7Oxu7dxNVVsBbDYwxP+Joq+GvpgYcN1Hvxssp
Ly/H1q1b8f7779u+d/DgQYSHh8NsNiMzMxPJyckICwtz2Aff8TLG/IajUj+T0m7HvMI7bY/udDod
6utvFPyrq6vrtaTZ0aNHsWrVKuzevdtW1h0AwsOthXw1Gg2ysrKwZ4+4rl+/3vHG45jD2PARbeT1
n6S5mE52jhwCGCUOzxlRTnbx1pRlEgMJaCXaRIvDQXMahPHmTx3/72sTPlocv0TEAQxBF9GCShf7
CTkGzhSK41PF4dFnviaHuDRpjDCeMFRcJXKERAHTjGmlwvibcYvJPr6+Ik6Na/90rLgDiZPDMIyI
Uyfnmc9LDOIezr65dn3vtqKiAhMmTEBZWRkef/xxuzZnz57F4sWLsW3bNkyadCMVsK2tDV1dXRg1
ahQaGxtRWlqKhx9+WDgebzUwxvzGVakzVntXVFQEg8GAjo4O5OXlISQkBEajEYC1zPsTTzyBL7/8
0lZjMiAgANXV1WhoaMCiRdYq3+PGjUNBQQEiIyOFY/HCyxjzG66kk6WmpsJstv+wh8FgsP35pZde
wksvvdTjupiYGBw+fLhPY/HCyxjzG/yRYcYY8zBf+cgwL7yMMb/Bx0IyxpiH+cpWg6L25XNufelY
UaCecBx/d9JdZB/DiZScKogPo5iM48I4AAxGpzAeKZGTdoGoylmKDGH8bhwgx2jCOGF8yVXxUWyP
Bf6CHCMPvxbGz0H8Ti0ApCrzhPETas83J24m86vip8rfhPGv1Exh/P/NFedYAgA2isMVevFrbxwu
kkO0YbgwPp6sxAp8iOnC+KJPxEecNU2l88n+F+Kf6QTi38gdEv8OI5SLffrIbW8URcG/qv8u1faX
ypMuj+cKvuNljPmNqz5Sc034ybXc3FyMHz8eCQk3Dv0sLCxEREQEtFottFot9u3b1++TZIwxGc6e
1eBpwoV3xYoVPRZWRVGwdu1a1NbWora2FnPnzu3XCTLGmCxHHxnu/hhowqX/7rvvhsVi6fH9gdwb
YYwxR7xhUZXh1CE5xcXFmDlzJp5++mm0tra6e06MMeYUZ8/j9bQ+b3asXr0aP//5z9HS0oL169fD
aDRi3bp1vbYtvOlN8jS99cEYYx+YOvCBqcPt/XrD/q0MMp3MYrEgMzMTH3/c8zSmI0eO4P7778fB
gz0rMSqKAuwXdP2BxOw2E/ELRLzzI4lBiB/+sxL/W4jrIoLIWAMgkd5ECRenUJHPFQDgd0RcnMYF
APvVvcJ46ogqYRztVHVGQP2+OK1N+bM4fekD9UfkGA/iN8L4oZLviTsgf+agC1FuleiDOnROkNIJ
AGiiT1HDZnHaG54jrqeKvQIAFLekk/2zukWq7e+U1b6VTnbhwgWEh4ejs7MT27dvx7x54hw/xhjz
lK99JJ1MuPDm5ORg//79aGpqQmRkJDZu3AiTyYTDhw9j6NChSElJwerVqz01V8YYE/KG/VsZwoX3
tdde6/G93NzcfpsMY4y5wlf2eLn0D2PMb7iSx1tRUQGNRoPY2FgUFxf3iG/btg2JiYlITEzE8uXL
cfz4celru+OFlzHmN1xZePPz82E0GlFeXo7NmzejqanJLh4TE4OKigocOXIEGRkZePLJJ6Wv7Y4X
XsaY33A2j7e5uRkAkJKSgqioKKSnp6Oqyj4D56677rLVZps/fz72798vfW13/bshckUQC3BD/1Qf
nUQaDAAgWBwW/R1k50GRmifRhipIKDNEO5UuFkV2QZ7mJq4hCbTTBTVp4pPcRoH+0E8bRogbUKlg
RJ1WAMBlIi7zPlE0ERfXQAWaJJYA6gAz6vUvs8rIpN9JcHaPt6amBnFxcbav4+PjUVlZifnz5/fa
/sUXX0RmZqZT1wJ8OhljzI84Sie7ZDqKS6ajbhmjvLwcW7duxfvvv+90H7zVwBjzG462FkamaRFR
+BPbozudTof6+nrb13V1dZg5c2aPdkePHsWqVauwe/dujBkzpk/X3owXXsaY33D2WMjre7cVFRWw
WCwoKyuDXm//qdWzZ89i8eLF2LZtGyZNmtSna7vjrQbGmN9w5XSyoqIiGAwGdHR0IC8vDyEhITAa
jQCsZd6feOIJfPnll1i1ahUAICAgANXV1Q6vFeGFlzHmN1xZeFNTU2E2m+2+ZzAYbH9+6aWX8NJL
vZeu6u1aEV54GWN+w1fO4+3fhdciiF2SuJ5q0/4l0UAjMQhxOpnMz5E84Knn6W32iJOuAACfi8NU
2lA7Ub0RAIY/TvRBd/FraiKFRAcWiXSyaqpBmzB6kUg3A4BTX35H3ICqgSqTTkalaRE/cgBAJRGn
0gxlBpl1uzj+L4o4LrPK/KNEGwlXEeiejvoZ3/EyxvwG3/EyxpiH8cLLGGMe5hfHQjLGmC/xlWMh
fWOWjDEmgbcaGGPMw3xl4SWLXTrdsaIAuwRdWyQ6eZ2IUyeHyZwsRrXpWYSjp3uIOJGNg4sSY1BF
Dc1EuhiVKiYzhsTzefmM+IV/u3JeGG8upyYBqA+J05cU4iX9t9PjyTHmYp8wbt6uFXcwU+Kf1Z+I
NKz/T3dBnpKmlhMNEsghpqviapWHTn9X3MFJ4u8JABnuKXYZdFWqqiuaA8N9q9glY4x5q65O31jS
fGOWjDEmoavTN7YaeOFljPkNXngZY8zDOjt44WWMMY+61uUbS5pvzJIxxmTwVgOATwQxKlUMAD5u
IRpYqA4kBiGO3Fr/U4kuiHmcpI71kqgF9VW9OK4h0sXMFnqMM+JUL4A6DQ54M3CJMN68iEgX20kO
AfwzEf/d/wjDf8Ud5BCWlmhxA+r1+4JEChV1+t454uQ8AEigKk3OEYfJf2PAoaeJ0/P2Ex1QJ+e5
0xXnl7SKigoYDAZ0dnYiLy8PDz30kF28vr4eK1asQG1tLX7xi1+goKDAFouOjsbo0aMxePBguwPS
HeE7XsaY/3ChWnF+fj6MRiOioqKQkZGBnJwcu0oS48aNQ3FxMd56660e1yqKApPJhOBgomr5N4Q1
13JzczF+/HgkJNxIsm5tbcWCBQswYcIEZGdn4/JlqkY1Y4x5SKfko5vm5mYAQEpKCqKiopCeno6q
qiq7NqGhoZgxYwYCAnr/LaMvH8gQLrwrVqzAvn32n+DZsmULJkyYgBMnTiAiIgIvvPCC9GCMMdav
nFx4a2pqEBcXZ/s6Pj4elZXUKfM3KIqC2bNnIzs7G7t37ybbC7ca7r77blgsFrvvVVdX47HHHkNg
YCByc3O04nJmAAAQoElEQVTx1FNPSU+OMcb6laNt8Y9M1kc/OXjwIMLDw2E2m5GZmYnk5GSEhTl+
P6PP5d1v/p8hLi6O3ERmjDGP6XLwSEwDVhTeeHSj0+lQX3/jDey6ujrMnDlTetjw8HAAgEajQVZW
Fvbs2SNs3+c31/p0sMSfC2/8eWIaEJPW1+EYY/6o1QRcNrm/XyffXAsKCgJgzWyYMGECysrK8Pjj
vWcKdV8D29ra0NXVhVGjRqGxsRGlpaV4+OGHheP1eeHV6XQwm83QarUwm83Q6XSOG/+k0HFsssRg
H1OFD2OJOJUeBQBEOs4kiS4OUKddUcePEaliAIA4cZhM2aFP5ALEp1DJCKH+rhaXhwBOUA2ihdFA
fE0OMWp0qzDePn6sK1OwaiLiZipVDHTBTPJ1MZweI5yINzozhzRASbvpa4lirDJkTiR0oKioCAaD
AR0dHcjLy0NISAiMRiMAa5n3hoYG6HQ6tLS0YNCgQXj++edx7NgxfPHFF1i0aBEAa+ZDQUEBIiMj
hWP1eeHV6/UoKSnBM888g5KSkj7djjPGWL9yIZ0sNTUVZrPZ7nsGg8H257CwMJw717O89MiRI3H4
8OE+jSXc483JycF3v/tdHD9+HJGRkXjllVewevVqnD17FpMnT8b58+exatWqPg3IGGP9xsmsBk8T
3vG+9lrvp4Dv2rWrXybDGGMu8YJFVQZ/co0x5j8kPmXtDXjhZYz5j66BnoAcXngZY/6DtxoAiOrO
1cl0QJ2c9DkRv1NiDOJ3E6kfJJWS8zIRXykxhji9CeOIy7/6iB5iCHGSlcRzcQDEOA8SHchktJVR
DcQ/j1vJ1w3Q2jJK3OAU0QFds5NOw5J57VG/WlOvizMSKWuziNz9euIkNpmUTJl/AjJcSCfzJL7j
ZYz5D77jZYwxD+OFlzHGPIwXXsYY8zBOJ2OMMQ/jdDKID9cIEcRsqKwG6h1Zup4U2cefJLogD/gg
6qFRdd8AkL9DkecBEXWzAPrplJCBUmH86SnUcyGhZ+WVbjQuDxE92iKMmzuJQ3LIOULix26i+zif
Jo5TmRNSt4jEMkFlLchkeLgLZzUwxpiH8R4vY4x5GO/xMsaYh/nIHm+fS/8wxpjXcuFYyIqKCmg0
GsTGxqK4uLhHvL6+HnfddReGDRuGZ599tk/Xdsd3vIwx/+HCHm9+fj6MRiOioqKQkZGBnJwchITc
yAIYN24ciouL8dZbPd85pa7tju94GWP+o0Py0U1zczMAICUlBVFRUUhPT0dVVZVdm9DQUMyYMQMB
AQF9vra7/r3jjRbELBLXj4oQx6nZj5EYI5qIvytRC2oskSL1Q+L6IRJ1r05Gi+O/Iq430UOQ+2PD
6C7C8Zkwnq1/XRgvTyAO6gGALUQ8Uxy+rUt0epPVnMHlwrh5jFbcQbvEoUS4XRwelUZ3YZIYRuQ9
OocwPWa3MP7OsAxhPPu2neQYMtl3Uq46d9nN1dMBID4+HpWVlZg/f36/XMtbDYwx/+Foq+FzE/CF
yYMTEeOtBsaY/3C0tRCcBsQV3nh0o9PpUF9/o9p3XV2ddCFfZ67lhZcx5j+6JB/dBAUFAbBmJ1gs
FpSVlUGv1/c6hKran0/cl2uv460Gxpj/cCGroaioCAaDAR0dHcjLy0NISAiMRiMAa5n3hoYG6HQ6
tLS0YNCgQXj++edx7NgxjBw5stdrRXjhZYz5DxcW3tTUVJjNZrvvGQwG25/DwsJw7tw56WtFeOFl
jPkPH/nIsKJ237BwV8eKAswRdG2S6KTzKNGAKtBFHtkF4Etx+B6J07TetRANqP/f6ok4QObfTfyp
OH5G5hVJPV90rbJ31HXCeHruAXEHRBgA1ChxjS/lz78Vxj9QN5Nj3FVRK26wiuhAps4Y9fI1f0r3
oSVSLpuI689JnIz3MpHuSJ3gR5QLBACUKz32TvtKURTgbsk+Drg+niv4jpcx5j/4dDLGGPMwH9lq
cHrhjY6OxujRozF48GAEBASgurranfNijLG+85HTyZxeeBVFgclkQnBwsDvnwxhjzvs2bDUM5OY0
Y4z14CMLr9OfXFMUBbNnz0Z2djZ27xYfosEYYx7h5Olknub0He/BgwcRHh4Os9mMzMxMJCcnIyys
W1W7hsIbf741DRifduNrj+zFEKliAABiq8QiMw71k6ROH5N5JRB9kCeHyVSypFKL6D66qJcUlVok
c7rUrVQD8XM1Bl/RY1AFGqkikjIn412iGoyg+6DmSY4hcTIe9Xeh7jJ7u77RZH24m5Onk3ma0wtv
eLi1hLBGo0FWVhb27NmD++67z75RQqErc2OM+avQNOvjumMSx6/K8Oethra2NrS2Wm9dGhsbUVpa
irlz57p1Yowx1mf+vNXw+eefY+HChQCs5TAKCgoQGRnp1okxxlif+XM62cSJE3H48GF3z4Uxxlzj
I1sN/Mk1xpj/4IWXMcY8zAv2b2X078IrOlxJlTgViTwt62MiniAxBoFMxwHoNKsWIp4mMcYJcZhM
J5NIrRuuEcclXtR/xR3iBvcSHci8VUCdhkW8rLfjH+kxqIwz6tQvmXQy8vm8SPcxhkiHjBOHpdIl
o4n4MiI+UmKMNyXayHDhjreiogIGgwGdnZ3Iy8vDQw891KPNo48+ijfeeANjx47Ftm3bbEUu+3qE
At/xMsYYgPz8fBiNRkRFRSEjIwM5OTl2lSSqq6tx4MABfPjhhygtLcW6devwpz9Z7wL6eoQC11xj
jH3rNTc3AwBSUlIQFRWF9PR0VFVV2bWpqqrCkiVLEBwcjJycnB4VJ/pyhAIvvIyxb72amhrbtgEA
xMfHo7Ky0q5NdXU14uPjbV+Hhobi9OnTAPp+hAJvNTDG/IijjfP9ACpc6llVVYd3tVJHKNyE73gZ
Y36k08HjewAevelhT6fTob7+Rgmuuro6zJw5066NXq/HsWPHbF83NjYiJiYGQO9HKIjwwssY8yPO
fWY4KCgIgDWzwWKxoKysDHq93q6NXq/Hjh07cPHiRWzfvh0ajTULyJkjFPp3q0EmjUSIqmqRTMRv
d3UCkukp1NNIvdMpcUIUldNDpZONkni3VSYFiqCnfmbjiQ6oOABMIOIn7hSGE7CNHmOsxDxc9Xeq
gczrgnCZiI+T6IP6dxxCxIMkxnAbmTTV3hUVFcFgMKCjowN5eXkICQmB0WgEYC3znpycjFmzZmHG
jBkIDg7G1q1bAQANDQ1YtGgRAPkjFHiPlzHmR5z/BEVqamqPTAWDwWD39aZNm7Bp0ya778XExPT5
CAVeeBljfsQ3PjPMCy9jzI/4xmeGeeFljPkRvuNljDEP4ztexhjzMOezGjypfxdeYSrLMxIdbHBt
fEUiHWcwEZdJsUqKEMepk6ymSIzx19HiOHVCFDUHgP67StxMtBMpUFP1NcK4JWEiPcirRHx4rDCc
gKP0GB9SDYgT5yKJnxdAH2p3hXhdAUA+EQ8lzg/Yp5BDJN8h/sTXx2HiUwDjRx8TxgHgENlCFm81
MMaYh/FWA2OMeRjf8TLGmIfxHS9jjHkY3/EyxpiH8R0vY4x5GKeTAQc2Oo7d/Th9PXUqEnXykkQ2
DhqJ+L9L9GEh4heIeLjEGFoiHk3EyWKY7unjnpMfCOMTJ1mE8fYRI8gxLGaiwT3i8J8xhxwD7xLx
u4l0sd/QQ5C/Fb8t0UfkVXH8UqBEJ2LLidPcDo2eIYwfQ7ww7l58x8sYYx7Ge7yMMeZhvnHH63QF
ioqKCmg0GsTGxqK4uNidc/Ksr0wDPQM5p00DPQMppiq6jTc4YaL2f7yEj/zcG0x/HegpfMNR6Z/u
j55k1rRHH30UMTExmD59ul2poL6uh04vvNdr0JeXl2Pz5s1oapL5TKoX8pWF94xpoGcghRdeN/OR
hfdz0/GBnsI3nCv9A9BrWnV1NQ4cOIAPP/wQ69atw7p166Sv7c6phVemBj1jjHmec3e8MmtaVVUV
lixZguDgYOTk5NiqVTizHjq18MrUoGeMMc9rl3zYk1nTqqurER9/I0MjNDQUp06dcmo97Oc31wod
hw4IYp52WpD2Vu65aZD+Ipinl9gIYKNwi+tHLo9Bnl/2rvjErQe/Ce/dWCto9XJfptSTzIlzssoF
P/d/ceM4Dqx5gGrxIgDg6EZxSXPPKJRqNXJk3yvxqqoKVbU/7U1R6NPdeuPUHa9MDfrrk+QHP/jB
D5mHq/oy1vVy7H1Z0/R6PY4du3HEZWNjI2JiYjBjxgzy2u6cWnhlatAzxpivkFnT9Ho9duzYgYsX
L2L79u3QaDQAgDFjxpDXduf0VkNvNegZY8xX9bamGY1GANYy78nJyZg1axZmzJiB4OBgbN26VXit
kOpm+/fvV+Pi4tRJkyapv/71r93dvdtERUWpCQkJalJSkqrT6QZ6OjYrVqxQb731VnXq1Km277W0
tKhZWVlqZGSkumDBArW1tXUAZ2jV2zwff/xx9fbbb1eTkpLUpKQk9e233x7AGVqdPXtWTUtLU+Pj
49XU1FR127Ztqqp633PqaJ7e9Jy2t7erycnJamJioqrX69X//M//VFXV+55LX+D2hTcpKUndv3+/
arFY1MmTJ6uNjY3uHsItoqOj1YsXLw70NHqoqKhQP/roI7sF7emnn1YffPBB9cqVK+oDDzyg/upX
vxrAGVr1Ns/CwkL12WefHcBZ9XThwgW1trZWVVVVbWxsVCdOnKi2tLR43XPqaJ7e9pz+/e9/V1VV
Va9cuaJOmTJFPX78uNc9l77A6Q9Q9MbX8ntVN2zou9vdd9+NsWPH2n2vuroaK1euRGBgIHJzc73i
Oe1tnoD3PadhYWFISkoCAISEhGDKlCmoqanxuufU0TwB73pOR3xziNHly5fR2dmJwMBAr3sufYFb
F15fyu9VFAWzZ89GdnY2du/ePdDTEbr5eY2Li0N1dfUAz8ix4uJizJw5E08//XSPd44H2smTJ1FX
V4fk5GSvfk6vz/P6GzTe9Jxeu3YNiYmJGD9+PB588EFMmDDBq59Lb+XWhdeXHDx4EEeOHMFTTz2F
tWvXoqGhYaCn5JA33fGIrF69GmfOnEFpaSlOnTple2PCG7S2tmLp0qV47rnnMHLkSK99Tm+e5y23
3OJ1z+mgQYNw5MgRnDx5Ev/1X/+F2tpar30uvZlbF16ZXDhvER5uPQRXo9EgKysLe/Z4Q/J373Q6
ne3jiWazGTqdboBn1Ltbb70ViqIgKCgIDzzwAHbu3DnQUwIAdHR0YPHixbj33nuxYMECAN75nPY2
T299TqOjozFv3jxUVVV55XPp7dy68PpKfm9bW5vtV7bGxkaUlpZi7ty5Azwrx/R6PUpKStDe3o6S
khKv/c/swgXrwTOdnZ3Yvn075s2bN8Azsv62sHLlSkydOhVr1qyxfd/bnlNH8/Sm57SpqQmXLl0C
AFy8eBHvvPMOFixY4HXPpU9w97t1JpNJjYuLU7/zne+ozz//vLu7d4vTp0+riYmJamJiojp79mz1
5ZdfHugp2SxbtkwNDw9Xhw4dqkZERKglJSVema5zfZ4BAQFqRESE+vLLL6v33nuvmpCQoE6fPl19
+OGHvSJr5MCBA6qiKGpiYqJdSpa3Pae9zXPv3r1e9ZwePXpU1Wq16rRp09T09HT11VdfVVWV08mc
oagqb9AwxpgnfWvfXGOMsYHCCy9jjHkYL7yMMeZhvPAyxpiH8cLLGGMexgsvY4x52P8B1trTXziB
6KcAAAAASUVORK5CYII=
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Write QIIME&#39;s distance matrix format</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[63]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">qiime.format</span> <span class="kn">import</span> <span class="n">format_distance_matrix</span>

<span class="nb">open</span><span class="p">(</span><span class="s">&#39;/home/ubuntu/data/distance_matrix_fast.txt&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_distance_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">dist_mat</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-5-compute-pcoa-qiime-pycogent">Step 5. Compute PCoA: QIIME/PyCogent</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[64]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">!</span>principal_coordinates.py -i /home/ubuntu/data/distance_matrix_fast.txt -o /home/ubuntu/data/pc_fast.txt
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="step-6-display-pcoa-qiime">Step 6. Display PCoA: QIIME</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This generates an HTML file and java visualization for the data. To do this we need one additional file: tree_metadata.txt. You can view this file directly <a href="http://qiime.org/home_static/nih-cloud-apr2012/tree_metadata.txt">here</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[65]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">!</span>wget http://qiime.org/home_static/nih-cloud-apr2012/tree_metadata.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
--2012-08-06 22:20:12--  http://qiime.org/home_static/nih-cloud-apr2012/tree_metadata.txt
Resolving qiime.org... 216.34.181.97
Connecting to qiime.org|216.34.181.97|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 9313 (9.1K) [text/plain]
Saving to: &#96;tree_metadata.txt&apos;

100%[======================================&gt;] 9,313       --.-K/s   in 0.02s   

2012-08-06 22:20:13 (393 KB/s) - &#96;tree_metadata.txt&apos; saved [9313/9313]


</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can then generate 3D PCoA plots.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[69]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">!</span>make_3d_plots.py -i /home/ubuntu/data/pc_fast.txt -o /home/ubuntu/data/pcoa_plots/ -m /home/ubuntu/tree_metadata.txt
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the notebook simply serves these files up in <code>/files</code>, so we can visit the visualization <a href="/files/data/pcoa_plots/pc_fast_3D_PCoA_plots.html" target=_blank>directly</a></p>
<p><strong>NOTE</strong>: The above link is not static: to view the plot, you must run the notebook. </p>
</div>
</div>
</div>